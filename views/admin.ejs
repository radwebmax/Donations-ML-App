<!-- views/admin.ejs -->
<%- include('partials/header', { title: 'Admin Dashboard' }) %>

<main class="page-width">
    <%- include('partials/account-details', { title: 'Admin Dashboard' }) %>

    <section class="admin__all-posts">
        <h1 class="h1 text-center">–û—á—ñ–∫—É—é—Ç—å –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</h1>
        <ul class="collections__grid">
            <% posts.forEach(function(post) { %>
                <% if (post.status == 'Pending') { %>
                    <li class="collections__grid-item">
                        <div class="post__control">
                            <form action="/delete/<%= post._id %>" method="post">
                                <button type="submit" class="btn_no-styles delete-post__btn">
                                    <img src="/img/close-icon.svg" alt="edit icon" width="24px">
                                    –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </form>
                            <a class="edit__post" href="/edit/<%= post._id %>">
                                <img src="/img/edit-icon.svg" alt="edit icon" width="24px">
                                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </a>
                        </div>
                        
                        <div class="post__header">
                            <div class="post__date"><%= post.creationDate.toISOString().split('T')[0].replaceAll('-', '.') %></div>
                            <div class="post__status">
            
                                <% if (post.status == 'Verified') { %>
                                    üü¢
                                <% } else if (post.status == 'Closed') { %>
                                    üîµ
                                <% } else { %>
                                    üü°
                                <% } %>  
                                <form action="/updateStatus/<%= post._id %>" method="post" class="editPostStatusform">
                                    <select name="status">
                                        <option value="Pending" <%= post.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                                        <option value="Verified" <%= post.status === 'Verified' ? 'selected' : '' %>>Verified</option>
                                        <option value="Closed" <%= post.status === 'Closed' ? 'selected' : '' %>>Closed</option>
                                    </select>
                                    <!-- <button type="submit">–û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button> -->
                                </form>
                            </div>
                        </div>
                        <div class="post__body">
                            <p class="post__title fw-600">
                                <%= post.name %>
                            </p>
                    
                            <% if (post.moneyCollected > 0) { %>
                                <div class="border-radius__container">
                                    <progress max="<%= post.moneyNeeded %>" value="<%= post.moneyCollected %>"></progress>
                                </div>
                                
                            <% } %>  
                            <div class="post__row post__amount">
                                <p>–ü–æ—Ä—Ç—ñ–±–Ω–∞ —Å—É–º–∞:</p>
                                <p class="fw-600 uppercase"><%= post.moneyNeeded %> ‚Ç¥</p>
                            </div>
                    
                            <% if (post.moneyCollected > 0) { %>
                                <div class="post__row post__amount">
                                    <p>–ó—ñ–±—Ä–∞–Ω–∞ —Å—É–º–∞:</p>
                                    <p class="fw-600 uppercase"><%= post.moneyCollected %> ‚Ç¥</p>
                                </div>
                            <% } %>
                            
                            <% if (post.category) { %>
                                <div class="post__row post__amount">
                                    <p>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</p>
                                    <p class="fw-600 uppercase"><%= post.category %></p>
                                </div>
                            <% } %>
                    
                            <% if (post.promoted == true) { %>
                                <div class="post__row post__promoted">
                                    <p>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥:</p>
                                    <p class="fw-600 uppercase">–¢–∞–∫</p>
                                </div>
                            <% } %>
                        
                            <% if (post.predictedDeadline) { %>
                                <div class="post__row">
                                    <p>–ü—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:</p>
                                    <p class="fw-600 uppercase"><%= post.predictedDeadline.toISOString().split('T')[0].replaceAll('-', '.') %></p>
                                </div>
                            <% } %>
                            
                            <div class="post__row post__deadline">
                                <p>–î–µ–¥–ª–∞–π–Ω:</p>
                                <p class="fw-600 uppercase"><%= post.deadline.toISOString().split('T')[0].replaceAll('-', '.') %></p>
                            </div>
                    
                        
                        </div>
        
                        <div class="post__footer">
                            <div class="post__payments">
                                <p class="make__payment text-center fw-600">–ü–ª–∞—Ç—ñ–∂–Ω—ñ –¥–∞–Ω—ñ:</p>
                                <div class="payment__method monobank">
                                    <img src="/img/monobank-icon.svg" alt="monobank icon" width="20">
                                    <a href="/" class="color-black payment__method-label"><%= post.monobankUrl %></a>
                                    <div class="jar__amounts">
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate50&a=50" class="jar__amount">‚ù§Ô∏è 150‚Ç¥</a>
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate200&a=200" class="jar__amount">‚ù§Ô∏è 200‚Ç¥</a>
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate1000&a=1000" class="jar__amount">‚ù§Ô∏è 500‚Ç¥</a>
                                    </div>
                                </div>
                                <div class="payment__method privat">
                                    <img src="/img/privat-icon.svg" alt="monobank icon" width="20">
                                    <a href="/" class="color-black payment__method-label"><%= post.privatUrl %></a>
                                </div>
                            </div>
                        </div>
        
                        <a class="post__link btn uppercase fw-600 color-black bg-yellow" href="/post/<%= post._id %>">–î–µ—Ç–∞–ª—ñ</a>
                    
                    </li>
                <% } %>  
            <% }); %>
        </ul>

        <h2 class="h1 text-center collections__grid_mt">–ê–∫—Ç–∏–≤–Ω—ñ –∑–±–æ—Ä–∏</h2>
        <ul class="collections__grid">
            <% posts.forEach(function(post) { %>
                <% if (post.status == 'Verified') { %>
                    <li class="collections__grid-item">
                        <div class="post__control">
                            <form action="/delete/<%= post._id %>" method="post">
                                <button type="submit" class="btn_no-styles delete-post__btn">
                                    <img src="/img/close-icon.svg" alt="edit icon" width="24px">
                                    –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </form>
                            <a class="edit__post" href="/edit/<%= post._id %>">
                                <img src="/img/edit-icon.svg" alt="edit icon" width="24px">
                                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </a>
                        </div>
                        
                        <div class="post__header">
                            <div class="post__date"><%= post.creationDate.toISOString().split('T')[0].replaceAll('-', '.') %></div>
                            <div class="post__status">
            
                                <% if (post.status == 'Verified') { %>
                                    üü¢
                                <% } else if (post.status == 'Closed') { %>
                                    üîµ
                                <% } else { %>
                                    üü°
                                <% } %>  
                                <form action="/updateStatus/<%= post._id %>" method="post" class="editPostStatusform">
                                    <select name="status">
                                        <option value="Pending" <%= post.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                                        <option value="Verified" <%= post.status === 'Verified' ? 'selected' : '' %>>Verified</option>
                                        <option value="Closed" <%= post.status === 'Closed' ? 'selected' : '' %>>Closed</option>
                                    </select>
                                    <!-- <button type="submit">–û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button> -->
                                </form>
                            </div>
                        </div>
                        <div class="post__body">
                            <p class="post__title fw-600">
                                <%= post.name %>
                            </p>
                    
                            <% if (post.moneyCollected > 0) { %>
                                <div class="border-radius__container">
                                    <progress max="<%= post.moneyNeeded %>" value="<%= post.moneyCollected %>"></progress>
                                </div>
                                
                            <% } %>  
                            <div class="post__row post__amount">
                                <p>–ü–æ—Ä—Ç—ñ–±–Ω–∞ —Å—É–º–∞:</p>
                                <p class="fw-600 uppercase"><%= post.moneyNeeded %> ‚Ç¥</p>
                            </div>
                    
                            <% if (post.moneyCollected > 0) { %>
                                <div class="post__row post__amount">
                                    <p>–ó—ñ–±—Ä–∞–Ω–∞ —Å—É–º–∞:</p>
                                    <p class="fw-600 uppercase"><%= post.moneyCollected %> ‚Ç¥</p>
                                </div>
                            <% } %>
                            
                            <% if (post.category) { %>
                                <div class="post__row post__amount">
                                    <p>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</p>
                                    <p class="fw-600 uppercase"><%= post.category %></p>
                                </div>
                            <% } %>
                    
                            <% if (post.promoted == true) { %>
                                <div class="post__row post__promoted">
                                    <p>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥:</p>
                                    <p class="fw-600 uppercase">–¢–∞–∫</p>
                                </div>
                            <% } %>
                        
                            <% if (post.predictedDeadline) { %>
                                <div class="post__row">
                                    <p>–ü—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:</p>
                                    <p class="fw-600 uppercase"><%= post.predictedDeadline.toISOString().split('T')[0].replaceAll('-', '.') %></p>
                                </div>
                            <% } %>
                            
                            <div class="post__row post__deadline">
                                <p>–î–µ–¥–ª–∞–π–Ω:</p>
                                <p class="fw-600 uppercase"><%= post.deadline.toISOString().split('T')[0].replaceAll('-', '.') %></p>
                            </div>
                    
                        
                        </div>
        
                        <div class="post__footer">
                            <div class="post__payments">
                                <p class="make__payment text-center fw-600">–ü–ª–∞—Ç—ñ–∂–Ω—ñ –¥–∞–Ω—ñ:</p>
                                <div class="payment__method monobank">
                                    <img src="/img/monobank-icon.svg" alt="monobank icon" width="20">
                                    <a href="/" class="color-black payment__method-label"><%= post.monobankUrl %></a>
                                    <div class="jar__amounts">
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate50&a=50" class="jar__amount">‚ù§Ô∏è 150‚Ç¥</a>
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate200&a=200" class="jar__amount">‚ù§Ô∏è 200‚Ç¥</a>
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate1000&a=1000" class="jar__amount">‚ù§Ô∏è 500‚Ç¥</a>
                                    </div>
                                </div>
                                <div class="payment__method privat">
                                    <img src="/img/privat-icon.svg" alt="monobank icon" width="20">
                                    <a href="/" class="color-black payment__method-label"><%= post.privatUrl %></a>
                                </div>
                            </div>
                        </div>
        
                        <a class="post__link btn uppercase fw-600 color-black bg-yellow" href="/post/<%= post._id %>">–î–µ—Ç–∞–ª—ñ</a>
                    
                    </li>
                <% } %>  
            <% }); %>
        </ul>

        <h2 class="h1 text-center collections__grid_mt">–ê—Ä—Ö—ñ–≤</h2>
        <ul class="collections__grid">
            <% posts.forEach(function(post) { %>
                <% if (post.status == 'Closed') { %>
                    <li class="collections__grid-item">
                        <div class="post__control">
                            <form action="/delete/<%= post._id %>" method="post">
                                <button type="submit" class="btn_no-styles delete-post__btn">
                                    <img src="/img/close-icon.svg" alt="edit icon" width="24px">
                                    –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </form>
                            <a class="edit__post" href="/edit/<%= post._id %>">
                                <img src="/img/edit-icon.svg" alt="edit icon" width="24px">
                                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </a>
                        </div>
                        
                        <div class="post__header">
                            <div class="post__date"><%= post.creationDate.toISOString().split('T')[0].replaceAll('-', '.') %></div>
                            <div class="post__status">
            
                                <% if (post.status == 'Verified') { %>
                                    üü¢
                                <% } else if (post.status == 'Closed') { %>
                                    üîµ
                                <% } else { %>
                                    üü°
                                <% } %>  
                                <form action="/updateStatus/<%= post._id %>" method="post" class="editPostStatusform">
                                    <select name="status">
                                        <option value="Pending" <%= post.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                                        <option value="Verified" <%= post.status === 'Verified' ? 'selected' : '' %>>Verified</option>
                                        <option value="Closed" <%= post.status === 'Closed' ? 'selected' : '' %>>Closed</option>
                                    </select>
                                    <!-- <button type="submit">–û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button> -->
                                </form>
                            </div>
                        </div>
                        <div class="post__body">
                            <p class="post__title fw-600">
                                <%= post.name %>
                            </p>
                    
                            <% if (post.moneyCollected > 0) { %>
                                <div class="border-radius__container">
                                    <progress max="<%= post.moneyNeeded %>" value="<%= post.moneyCollected %>"></progress>
                                </div>
                                
                            <% } %>  
                            <div class="post__row post__amount">
                                <p>–ü–æ—Ä—Ç—ñ–±–Ω–∞ —Å—É–º–∞:</p>
                                <p class="fw-600 uppercase"><%= post.moneyNeeded %> ‚Ç¥</p>
                            </div>
                    
                            <% if (post.moneyCollected > 0) { %>
                                <div class="post__row post__amount">
                                    <p>–ó—ñ–±—Ä–∞–Ω–∞ —Å—É–º–∞:</p>
                                    <p class="fw-600 uppercase"><%= post.moneyCollected %> ‚Ç¥</p>
                                </div>
                            <% } %>
                            
                            <% if (post.category) { %>
                                <div class="post__row post__amount">
                                    <p>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</p>
                                    <p class="fw-600 uppercase"><%= post.category %></p>
                                </div>
                            <% } %>
                    
                            <% if (post.promoted == true) { %>
                                <div class="post__row post__promoted">
                                    <p>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥:</p>
                                    <p class="fw-600 uppercase">–¢–∞–∫</p>
                                </div>
                            <% } %>
                        
                            <% if (post.predictedDeadline) { %>
                                <div class="post__row">
                                    <p>–ü—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:</p>
                                    <p class="fw-600 uppercase"><%= post.predictedDeadline.toISOString().split('T')[0].replaceAll('-', '.') %></p>
                                </div>
                            <% } %>
                            
                            <div class="post__row post__deadline">
                                <p>–î–µ–¥–ª–∞–π–Ω:</p>
                                <p class="fw-600 uppercase"><%= post.deadline.toISOString().split('T')[0].replaceAll('-', '.') %></p>
                            </div>
                    
                        
                        </div>
        
                        <div class="post__footer">
                            <div class="post__payments">
                                <p class="make__payment text-center fw-600">–ü–ª–∞—Ç—ñ–∂–Ω—ñ –¥–∞–Ω—ñ:</p>
                                <div class="payment__method monobank">
                                    <img src="/img/monobank-icon.svg" alt="monobank icon" width="20">
                                    <a href="/" class="color-black payment__method-label"><%= post.monobankUrl %></a>
                                    <div class="jar__amounts">
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate50&a=50" class="jar__amount">‚ù§Ô∏è 150‚Ç¥</a>
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate200&a=200" class="jar__amount">‚ù§Ô∏è 200‚Ç¥</a>
                                        <a href="https://send.monobank.ua/jar/4yiMoDeMAs?=donate1000&a=1000" class="jar__amount">‚ù§Ô∏è 500‚Ç¥</a>
                                    </div>
                                </div>
                                <div class="payment__method privat">
                                    <img src="/img/privat-icon.svg" alt="monobank icon" width="20">
                                    <a href="/" class="color-black payment__method-label"><%= post.privatUrl %></a>
                                </div>
                            </div>
                        </div>
        
                        <a class="post__link btn uppercase fw-600 color-black bg-yellow" href="/post/<%= post._id %>">–î–µ—Ç–∞–ª—ñ</a>
                    
                    </li>
                <% } %>  
            <% }); %>
        </ul>

    </section>
</main>

<%- include('partials/footer') %>

<script>
    let statusSelect = document.querySelectorAll('.editPostStatusform select');

    const ajaxEditStatus = event => {
        let form = event.target.closest('form');
        form.submit();
    }

    statusSelect.forEach(el => el.addEventListener('input', ajaxEditStatus));
</script>